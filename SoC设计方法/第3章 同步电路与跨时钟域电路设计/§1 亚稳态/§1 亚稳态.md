## 亚稳态概念
### 建立时间和保持时间
建立时间是指在时钟有效沿（下图为上升沿）之前，数据输入端信号必须保持稳定的最短时间。
![[Pasted image 20240512223110.png]]
保持时间是指在时钟有效沿（下图为上升沿）之后，数据输入端信号必须保持稳定的最短时间。hold time时序检查确保新数据不会在触发器稳定输出初始数据之前过早到达D端而覆盖其初始数据。
![[Pasted image 20240512223135.png]]

### 亚稳态概念
器件（寄存器）在保存数据的时间里无法判断数据逻辑的状况
### 亚稳态产生原因
在时钟变化的这段时间里，寄存器将对数据进行锁存。如果数据在这段时间内发生了变化，对于寄存器来说也就无法识别应该锁存哪个数据，到底是变化前的还是变化后的，寄存器的输出也将变得无法预测。因此，数据在建立时间和保持时间内必须保持稳定不变。

从更加宏观的设计角度来看，<font color="#00b0f0">异步逻辑是亚稳态出现的重要原因。</font>

在正常的同步电路中，亚稳态出现的可能性很小，除非时钟的设计有很大问题（比如时钟延迟、时钟抖动、时钟偏斜很严重）。而异步逻辑则很容易出现亚稳态。异步逻辑没有统一的时钟，各级触发器的状态变化不是在统一的时钟作用下完成的（触发器的状态变化不是同时发生的）。没有统一的时钟也就意味着控制信号随时可能发生变化，想要满足建立时间和保持时间的约束当然也就变的十分困难。
要解决这些原因，就要跨时钟域电路的帮助了
### MTBF（Mean Time Between Failures，平均故障间隔时间）
![[Pasted image 20240512224459.png]]
公式中的tr为有效的亚稳态最大分辨时间，是指触发器能够保持亚稳态输出，并不会引起故障的时间（从时钟沿开始）。f为采样时钟频率，即触发器的时钟频率。α为异步事件触发的频率，即异步输入每秒变化的次数。T0和τ为触发器参数，是由触发器的电气特性决定的参数，可用于表征触发器翻转速度的快慢。增加tr,或者减小τ\tau \tau ,T0,α以及f都可以加大 MTBF，即使两次故障出现的时间间隔加大。但在一般情况下，对于一个系统，其中的tr和f是固定的，故只能通过减小τ\tau \tau ,T0或者α来改善系统。降低输入信号的变化频率 a 可以满足建立时间和保持时间的要求。而τ,T0是器件的固有性质，只有用速度更快的器件才能减小。
对于典型的 0.25µm 工艺 ASIC 库中的一个触发器，取以下参数： tr=2.3ns，τ =0.31ns， T0=0.0096ps，f=100MHz，α=10MHz, 则 MTBF=2.01(day），即触发器每两天便可能出现一次亚稳态。如果将采样时间f和异步事件触发频率α都提高，亚稳态出现还要频繁。可见降低时钟频率可以大大减小亚稳态导致系统错误的出现，其原因在于，提供较长的决断时间可减小亚稳态传递到下一级的机会，提高系统的 MTBF。但是这样的解决方式并不能满足实际的需要。由上面的推导可知，一个在 a 时钟域的信号要过渡到 b 时钟域时，如果仅仅只用一个触发器将其锁存，那么用 b 时钟进行采样的结果将很有可能出现亚稳态。
## 跨时钟域电路
### 1.双锁存器法(电平同步器)
#### 双锁存器法概念
在一个信号从一个时钟域进入另一个时钟域之前，将该信号用新时钟域控制的两个锁存器连续锁存两次，最后得到的结果就能满足实际应用的要求。这种方法也被通俗地称为“打两拍”
![[Pasted image 20240512224302.png]]

#### MTBF计算
b_dat2 的 MTBF 为
![[Pasted image 20240512224845.png]]
#### 特点（优缺点）
优点：结构简单、易于实现、面积消耗较少  
缺点：增加了两个[触发器](https://so.csdn.net/so/search?q=%E8%A7%A6%E5%8F%91%E5%99%A8&spm=1001.2101.3001.7020)的延时  
条件：适合于慢时钟域到快时钟域**，都可以
### 2.单bit信号跨时钟域（快—>慢；慢->快）
### 3.多bit信号跨时钟域传输
